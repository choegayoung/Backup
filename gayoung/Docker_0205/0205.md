## docker

도커란? 여러 서버를 독립적으로 관리할 수 있게 한다

영역: 컨테이너, 볼륨, 네트워크

컨테이너는 이미지에 의존적이다.

- 네트워크 만들기
docker network create 설정이름
자동으로 드라이버가 bridge로 설정

- 네트워크 리스트 확인
docker network ls

- 네트워크 상세보기
docker network inspect 네트워크 이름


## Nginx로 가상환경 만들기

- nginx 설치
docker pull nginx:1.28

- 생성 후 실행
docker run --network=my-net -d -p 80:80 --name web nginx:1.28
        [네트워크 연결할 곳, 백그라운드에서 실행, 포트포워드, 컨테이너 이름] << 부가옵션. 중간에 들어감.
        이미지는 맨 마지막에 들어가야 함.
        포트포워드 -> 로컬포트(외부):컨테이너포트(내부)

- 컨테이너로 접근
docker exec -it web /bin/bash

- 문서파일로 출력
curl http://localhost:80/

- 업데이트
 apt update

- 툴 설치
apt install net-tools

- ip확인하기
(리눅스 환경이라서 ipconfig 안됨) ifconfig

- 컨테이너 삭제
docker rm -f 컨테이너명 (-f 는 묻지말고 지우라는 명령어)

- 핑 알아보기
설치하기
apt install iputils-ping

드라이버 연결
ping [ip 주소]
연결할 컨테이너 ip 모두 ping 하기
ip대신 컨테이너 이름도 가능
** 작업할 모든 프로그램 ip를 갖다쓰기 힘들잖아

- nginx 화면 경로
/usr/share/nginx/html/index.html

- vscode로 작성한 페이지를 띄우려면?
docker run -d -p 80:80 -v ./index.html:/usr/share/nginx/html/index.html --name web nginx:1.28
-v 는 내 컴퓨터에 있는 파일이나 폴더를 컨테이너 안의 특정 경로와 동기화하라는 의미.
이걸 '마운트' 라고 함
(내 컴퓨터에 있는 파일경로):(컨테이너 내부의 파일경로)

- 네트워크?
내부포트는 같아도 되지만 (격리되어있기 때문), 외부포트가 같으면 안된다.


## Dockerfile 설명

FROM : 기본 대상 이미지를 정의하는 속성
MAINTAINER : 작성자의 정보를 기록하는 속성
RUN : FROM의 이반 이미지 위에서 실행될 명령어 정의
COPY : 도커 컨테이너의 경로로 파일을 복사할 때 사용하는 속성
ENV : 도커 컨테이너의 환경변수를 정의 하는 속성
CMD : ["nginx","-g","daemon off;"] << 실행 할 때, 이 속성으로 컨테이너를 켜라. (생성 후 바로 실행할 수 있게)

- 이미지 만들기 (dockerfile 이 있는 위치 터미널에 입력)
docker build -t web:0.0.1 .

## 배포용 리액트 설정
config에  
base:"/",
  server: {
    host: true,
  },

- frontend 폴더 안에 dockerfile 생성
FROM node:24.13.0 as build

WORKDIR /app

COPY package.json ./
RUN npm i

COPY . .

RUN npm run build

FROM nginx:1.28

COPY --from=build /app/dist /usr/share/nginx/html

EXPOSE 80

CMD ["nginx","-g","daemon off;"]

- 라우터 기능을 넣으려면
/etc/nginx/conf.d/default.conf 수정
root   /usr/share/nginx/html;
index  index.html index.htm;
를 밖으로 빼고,
try_files $url /index.html 을 안에 넣는다

근데 매번 이렇게 하기 귀찮잖아?

default.conf 파일을 만들어서 수정내용을 싹다 넣어서 저장해