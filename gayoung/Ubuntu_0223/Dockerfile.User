FROM ubuntu:24.04

# package 설치 시 사용자 유무 확인 무시
ENV DEBIAN_FRONTEND=noninteractive

# openssh-server 설치
RUN apt update
RUN apt install -y openssh-server sudo
RUN mkdir /var/run/sshd

# root 계정 접속 허용
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config

# root 계정 비밀번호 설정
RUN echo 'root:1234' | chpasswd

# 일반 계정 생성
RUN useradd -m -s /bin/bash study
RUN echo "study ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# SSH 폴더 준비
RUN mkdir /home/study/.ssh
RUN chmod 700 /home/study/.ssh
COPY authorized_keys /home/study/.ssh/authorized_keys
RUN chown -R study:study /home/study/.ssh

EXPOSE 22

CMD ["/usr/sbin/sshd", "-D"]